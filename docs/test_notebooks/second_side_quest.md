# Second side quest


```python
import torch
import torch.nn as nn
import torchlensmaker as tlm

s1 = tlm.Sphere(diameter=15, r=12)


class Id(nn.Module):
    def forward(self, x):
        return x


# checks at each element boundary
# surface normals are unit
# shapes are correct
# wavelengths are in expected range

class Check(nn.Module):
    def __init__(self, tag):
        super().__init__()
        self.tag = tag

    def forward(self, inputs):
        print(f"[{self.tag}]", "P", inputs.P.shape)
        print(f"[{self.tag}]", "normals", inputs.normals.shape if inputs.normals is not None else None)
        return inputs


optics = tlm.Sequential(
    tlm.PointSource(beam_angular_size=20),
    tlm.Gap(15),
    tlm.KinematicSurface(nn.Sequential(
        
        tlm.CollisionSurface(s1),
        tlm.RefractiveBoundary("SF10-nd", "clamp"),
    ), s1, anchors=("origin", "extent")),
    Check("a"),
    tlm.KinematicSurface(nn.Sequential(
        
        tlm.CollisionSurface(s1),
        tlm.RefractiveBoundary("air", "clamp"),
        
    ), s1, scale=-1, anchors=("extent", "origin")),
)

tlm.show(optics, dim=2, end=20)
```

    [a] P torch.Size([10, 2])
    [a] normals None



<div data-jp-suppress-context-menu id='tlmviewer-f0bd4bf7' class='tlmviewer' style='width: 100%; aspect-ratio: 16 / 9;'></div><script type='module'>async function importtlm() {
    try {
        return await import("/tlmviewer.js");
    } catch (error) {
        console.log("error", error);
        return await import("/files/test_notebooks/tlmviewer.js");
    }
}

const module = await importtlm();
const tlmviewer = module.tlmviewer;

const data = '{"mode": "2D", "camera": "XY", "data": [{"type": "surfaces", "data": [{"matrix": [[1.0, 0.0, 15.0], [0.0, 1.0, 0.0], [0.0, 0.0, 1.0]], "samples": [[2.63250351, 7.50000143], [2.58157635, 7.43594599], [2.53108597, 7.37154436], [2.48103619, 7.30679989], [2.43142986, 7.24171686], [2.38226604, 7.17629385], [2.33355331, 7.11054182], [2.28528595, 7.04445457], [2.23747253, 6.97804165], [2.19011402, 6.91130447], [2.14321136, 6.84424591], [2.09676552, 6.7768693], [2.0507822, 6.70917702], [2.00526047, 6.64117336], [1.96020222, 6.57285786], [1.91561317, 6.50424194], [1.87149143, 6.43531799], [1.82784176, 6.36609793], [1.78466511, 6.29658127], [1.74196434, 6.22677183], [1.69973946, 6.15667343], [1.65799332, 6.08628845], [1.61672878, 6.01561975], [1.57594681, 5.94467211], [1.53565025, 5.87344742], [1.49583817, 5.80194759], [1.45651627, 5.73018074], [1.41768551, 5.65814686], [1.37934685, 5.58584976], [1.34150124, 5.51329279], [1.30415154, 5.44047976], [1.2672987, 5.36741352], [1.23094559, 5.2940979], [1.19509315, 5.22053576], [1.15974236, 5.14672852], [1.12489796, 5.07268715], [1.0905571, 4.9984045], [1.05672359, 4.92389202], [1.02340031, 4.84915066], [0.99058723, 4.77418375], [0.95828629, 4.69899464], [0.92649841, 4.62358713], [0.89522552, 4.54796457], [0.86446857, 4.47213078], [0.83423042, 4.3960886], [0.80451012, 4.31983948], [0.77531242, 4.24339247], [0.74663544, 4.16674709], [0.71848202, 4.08990908], [0.69085312, 4.01288033], [0.66375065, 3.93566513], [0.63717556, 3.85826683], [0.61112881, 3.78068924], [0.58561134, 3.70293546], [0.56062508, 3.62500978], [0.53617001, 3.54691529], [0.51224804, 3.46865344], [0.48886108, 3.3902328], [0.46600914, 3.31165457], [0.44369411, 3.23292208], [0.42191601, 3.15403962], [0.40067673, 3.0750103], [0.37997627, 2.99583769], [0.35981655, 2.91652608], [0.34019756, 2.83707881], [0.32112122, 2.75749683], [0.30258846, 2.67778945], [0.2845993, 2.59795737], [0.26715469, 2.51800442], [0.25025654, 2.43793464], [0.23390388, 2.35775137], [0.21809959, 2.27745843], [0.20284271, 2.19705963], [0.18813324, 2.11655855], [0.17397499, 2.03595924], [0.1603651, 1.95526218], [0.14730644, 1.87447715], [0.134799, 1.79360497], [0.1228447, 1.71264935], [0.11144066, 1.63161385], [0.10059071, 1.55050278], [0.09029388, 1.46931946], [0.08055115, 1.38806784], [0.0713625, 1.30675173], [0.06272888, 1.2253747], [0.05464935, 1.14393795], [0.04712582, 1.06245077], [0.04015923, 0.98091435], [0.03374672, 0.89933217], [0.02789307, 0.81770813], [0.02259445, 0.7360462], [0.01785469, 0.65434992], [0.01366997, 0.57262325], [0.0100441, 0.49086994], [0.00697517, 0.40909097], [0.0044651, 0.32729581], [0.00251102, 0.24548545], [0.0011158, 0.16366366], [0.00027847, 0.08183426], [0.0, -1.05e-06], [0.00027847, -0.08183426], [0.0011158, -0.16366366], [0.00251102, -0.24548545], [0.0044651, -0.32729581], [0.00697517, -0.40909097], [0.0100441, -0.49086994], [0.01366997, -0.57262325], [0.01785469, -0.65434992], [0.02259445, -0.7360462], [0.02789307, -0.81770813], [0.03374672, -0.89933217], [0.04015923, -0.98091435], [0.04712582, -1.06245077], [0.05464935, -1.14393795], [0.06272888, -1.2253747], [0.0713625, -1.30675173], [0.08055115, -1.38806784], [0.09029388, -1.46931946], [0.10059071, -1.55050278], [0.11144066, -1.63161385], [0.1228447, -1.71264935], [0.134799, -1.79360497], [0.14730644, -1.87447715], [0.1603651, -1.95526218], [0.17397499, -2.03595924], [0.18813324, -2.11655855], [0.20284271, -2.19705963], [0.21809959, -2.27745843], [0.23390388, -2.35775137], [0.25025654, -2.43793464], [0.26715469, -2.51800442], [0.2845993, -2.59795737], [0.30258846, -2.67778945], [0.32112122, -2.75749683], [0.34019756, -2.83707881], [0.35981655, -2.91652608], [0.37997627, -2.99583769], [0.40067673, -3.0750103], [0.42191601, -3.15403962], [0.44369411, -3.23292208], [0.46600914, -3.31165457], [0.48886108, -3.3902328], [0.51224804, -3.46865344], [0.53617001, -3.54691529], [0.56062508, -3.62500978], [0.58561134, -3.70293546], [0.61112881, -3.78068924], [0.63717556, -3.85826683], [0.66375065, -3.93566513], [0.69085312, -4.01288033], [0.71848202, -4.08990908], [0.74663544, -4.16674709], [0.77531242, -4.24339247], [0.80451012, -4.31983948], [0.83423042, -4.3960886], [0.86446857, -4.47213078], [0.89522552, -4.54796457], [0.92649841, -4.62358713], [0.95828629, -4.69899464], [0.99058723, -4.77418375], [1.02340031, -4.84915066], [1.05672359, -4.92389202], [1.0905571, -4.9984045], [1.12489796, -5.07268715], [1.15974236, -5.14672852], [1.19509315, -5.22053576], [1.23094559, -5.2940979], [1.2672987, -5.36741352], [1.30415154, -5.44047976], [1.34150124, -5.51329279], [1.37934685, -5.58584976], [1.41768551, -5.65814686], [1.45651627, -5.73018074], [1.49583817, -5.80194759], [1.53565025, -5.87344742], [1.57594681, -5.94467211], [1.61672878, -6.01561975], [1.65799332, -6.08628845], [1.69973946, -6.15667343], [1.74196434, -6.22677183], [1.78466511, -6.29658127], [1.82784176, -6.36609793], [1.87149143, -6.43531799], [1.91561317, -6.50424194], [1.96020222, -6.57285786], [2.00526047, -6.64117336], [2.0507822, -6.70917702], [2.09676552, -6.7768693], [2.14321136, -6.84424591], [2.19011402, -6.91130447], [2.23747253, -6.97804165], [2.28528595, -7.04445457], [2.33355331, -7.11054182], [2.38226604, -7.17629385], [2.43142986, -7.24171686], [2.48103619, -7.30679989], [2.53108597, -7.37154436], [2.58157635, -7.43594599], [2.63250351, -7.50000143]]}]}, {"type": "surfaces", "data": [{"matrix": [[-1.0, 0.0, 20.265006], [0.0, -1.0, 0.0], [0.0, 0.0, 1.0]], "samples": [[2.63250351, 7.50000143], [2.58157635, 7.43594599], [2.53108597, 7.37154436], [2.48103619, 7.30679989], [2.43142986, 7.24171686], [2.38226604, 7.17629385], [2.33355331, 7.11054182], [2.28528595, 7.04445457], [2.23747253, 6.97804165], [2.19011402, 6.91130447], [2.14321136, 6.84424591], [2.09676552, 6.7768693], [2.0507822, 6.70917702], [2.00526047, 6.64117336], [1.96020222, 6.57285786], [1.91561317, 6.50424194], [1.87149143, 6.43531799], [1.82784176, 6.36609793], [1.78466511, 6.29658127], [1.74196434, 6.22677183], [1.69973946, 6.15667343], [1.65799332, 6.08628845], [1.61672878, 6.01561975], [1.57594681, 5.94467211], [1.53565025, 5.87344742], [1.49583817, 5.80194759], [1.45651627, 5.73018074], [1.41768551, 5.65814686], [1.37934685, 5.58584976], [1.34150124, 5.51329279], [1.30415154, 5.44047976], [1.2672987, 5.36741352], [1.23094559, 5.2940979], [1.19509315, 5.22053576], [1.15974236, 5.14672852], [1.12489796, 5.07268715], [1.0905571, 4.9984045], [1.05672359, 4.92389202], [1.02340031, 4.84915066], [0.99058723, 4.77418375], [0.95828629, 4.69899464], [0.92649841, 4.62358713], [0.89522552, 4.54796457], [0.86446857, 4.47213078], [0.83423042, 4.3960886], [0.80451012, 4.31983948], [0.77531242, 4.24339247], [0.74663544, 4.16674709], [0.71848202, 4.08990908], [0.69085312, 4.01288033], [0.66375065, 3.93566513], [0.63717556, 3.85826683], [0.61112881, 3.78068924], [0.58561134, 3.70293546], [0.56062508, 3.62500978], [0.53617001, 3.54691529], [0.51224804, 3.46865344], [0.48886108, 3.3902328], [0.46600914, 3.31165457], [0.44369411, 3.23292208], [0.42191601, 3.15403962], [0.40067673, 3.0750103], [0.37997627, 2.99583769], [0.35981655, 2.91652608], [0.34019756, 2.83707881], [0.32112122, 2.75749683], [0.30258846, 2.67778945], [0.2845993, 2.59795737], [0.26715469, 2.51800442], [0.25025654, 2.43793464], [0.23390388, 2.35775137], [0.21809959, 2.27745843], [0.20284271, 2.19705963], [0.18813324, 2.11655855], [0.17397499, 2.03595924], [0.1603651, 1.95526218], [0.14730644, 1.87447715], [0.134799, 1.79360497], [0.1228447, 1.71264935], [0.11144066, 1.63161385], [0.10059071, 1.55050278], [0.09029388, 1.46931946], [0.08055115, 1.38806784], [0.0713625, 1.30675173], [0.06272888, 1.2253747], [0.05464935, 1.14393795], [0.04712582, 1.06245077], [0.04015923, 0.98091435], [0.03374672, 0.89933217], [0.02789307, 0.81770813], [0.02259445, 0.7360462], [0.01785469, 0.65434992], [0.01366997, 0.57262325], [0.0100441, 0.49086994], [0.00697517, 0.40909097], [0.0044651, 0.32729581], [0.00251102, 0.24548545], [0.0011158, 0.16366366], [0.00027847, 0.08183426], [0.0, -1.05e-06], [0.00027847, -0.08183426], [0.0011158, -0.16366366], [0.00251102, -0.24548545], [0.0044651, -0.32729581], [0.00697517, -0.40909097], [0.0100441, -0.49086994], [0.01366997, -0.57262325], [0.01785469, -0.65434992], [0.02259445, -0.7360462], [0.02789307, -0.81770813], [0.03374672, -0.89933217], [0.04015923, -0.98091435], [0.04712582, -1.06245077], [0.05464935, -1.14393795], [0.06272888, -1.2253747], [0.0713625, -1.30675173], [0.08055115, -1.38806784], [0.09029388, -1.46931946], [0.10059071, -1.55050278], [0.11144066, -1.63161385], [0.1228447, -1.71264935], [0.134799, -1.79360497], [0.14730644, -1.87447715], [0.1603651, -1.95526218], [0.17397499, -2.03595924], [0.18813324, -2.11655855], [0.20284271, -2.19705963], [0.21809959, -2.27745843], [0.23390388, -2.35775137], [0.25025654, -2.43793464], [0.26715469, -2.51800442], [0.2845993, -2.59795737], [0.30258846, -2.67778945], [0.32112122, -2.75749683], [0.34019756, -2.83707881], [0.35981655, -2.91652608], [0.37997627, -2.99583769], [0.40067673, -3.0750103], [0.42191601, -3.15403962], [0.44369411, -3.23292208], [0.46600914, -3.31165457], [0.48886108, -3.3902328], [0.51224804, -3.46865344], [0.53617001, -3.54691529], [0.56062508, -3.62500978], [0.58561134, -3.70293546], [0.61112881, -3.78068924], [0.63717556, -3.85826683], [0.66375065, -3.93566513], [0.69085312, -4.01288033], [0.71848202, -4.08990908], [0.74663544, -4.16674709], [0.77531242, -4.24339247], [0.80451012, -4.31983948], [0.83423042, -4.3960886], [0.86446857, -4.47213078], [0.89522552, -4.54796457], [0.92649841, -4.62358713], [0.95828629, -4.69899464], [0.99058723, -4.77418375], [1.02340031, -4.84915066], [1.05672359, -4.92389202], [1.0905571, -4.9984045], [1.12489796, -5.07268715], [1.15974236, -5.14672852], [1.19509315, -5.22053576], [1.23094559, -5.2940979], [1.2672987, -5.36741352], [1.30415154, -5.44047976], [1.34150124, -5.51329279], [1.37934685, -5.58584976], [1.41768551, -5.65814686], [1.45651627, -5.73018074], [1.49583817, -5.80194759], [1.53565025, -5.87344742], [1.57594681, -5.94467211], [1.61672878, -6.01561975], [1.65799332, -6.08628845], [1.69973946, -6.15667343], [1.74196434, -6.22677183], [1.78466511, -6.29658127], [1.82784176, -6.36609793], [1.87149143, -6.43531799], [1.91561317, -6.50424194], [1.96020222, -6.57285786], [2.00526047, -6.64117336], [2.0507822, -6.70917702], [2.09676552, -6.7768693], [2.14321136, -6.84424591], [2.19011402, -6.91130447], [2.23747253, -6.97804165], [2.28528595, -7.04445457], [2.33355331, -7.11054182], [2.38226604, -7.17629385], [2.43142986, -7.24171686], [2.48103619, -7.30679989], [2.53108597, -7.37154436], [2.58157635, -7.43594599], [2.63250351, -7.50000143]]}]}, {"type": "rays", "points": [[0.0, 0.0, 15.30749257, -2.69912395], [0.0, 0.0, 15.18049419, -2.07347111], [0.0, 0.0, 15.09010411, -1.46778058], [0.0, 0.0, 15.03198109, -0.8755132], [0.0, 0.0, 15.00352873, -0.29099312], [0.0, 0.0, 15.00352873, 0.29099312], [0.0, 0.0, 15.03198109, 0.8755132], [0.0, 0.0, 15.09010411, 1.46778058], [0.0, 0.0, 15.18049419, 2.07347111], [0.0, 0.0, 15.30749257, 2.69912395]], "color": "#ffa724", "variables": {"base": [-0.17453293, -0.13574783, -0.09696274, -0.05817764, -0.01939255, 0.01939255, 0.05817764, 0.09696274, 0.13574783, 0.17453293]}, "domain": {"base": [-0.17453293, 0.17453293]}, "layers": [1]}, {"type": "rays", "points": [[15.30749257, -2.69912395, 19.96362806, -2.67249731], [15.18049419, -2.07347111, 20.08611518, -2.06431052], [15.09010411, -1.46778058, 20.17491714, -1.46765691], [15.03198109, -0.8755132, 20.23283818, -0.87806203], [15.00352873, -0.29099312, 20.26144588, -0.29228478], [15.00352873, 0.29099312, 20.26144588, 0.29228478], [15.03198109, 0.8755132, 20.23283818, 0.87806203], [15.09010411, 1.46778058, 20.17491714, 1.46765691], [15.18049419, 2.07347111, 20.08611518, 2.06431052], [15.30749257, 2.69912395, 19.96362806, 2.67249731]], "color": "#ffa724", "variables": {"base": [-0.17453293, -0.13574783, -0.09696274, -0.05817764, -0.01939255, 0.01939255, 0.05817764, 0.09696274, 0.13574783, 0.17453293]}, "domain": {"base": [-0.17453293, 0.17453293]}, "layers": [1]}, {"type": "points", "data": [[0.0, 0.0], [15.0, 0.0], [17.632503, 0.0], [20.265006, 0.0]], "layers": [4]}, {"type": "rays", "points": [[19.96362806, -2.67249731, 39.5878683, 1.18615468], [20.08611518, -2.06431052, 39.884872, 0.76574748], [20.17491714, -1.46765691, 40.08081871, 0.47014669], [20.23283818, -0.87806203, 40.20082232, 0.25313633], [20.26144588, -0.29228478, 40.25798597, 0.07971538], [20.26144588, 0.29228478, 40.25798597, -0.07971538], [20.23283818, 0.87806203, 40.20082232, -0.25313633], [20.17491714, 1.46765691, 40.08081871, -0.47014669], [20.08611518, 2.06431052, 39.884872, -0.76574748], [19.96362806, 2.67249731, 39.5878683, -1.18615468]], "color": "#ffa724", "variables": {"base": [-0.17453293, -0.13574783, -0.09696274, -0.05817764, -0.01939255, 0.01939255, 0.05817764, 0.09696274, 0.13574783, 0.17453293]}, "domain": {"base": [-0.17453293, 0.17453293]}, "layers": [3]}]}';

setTimeout(() => {
    tlmviewer.embed(document.getElementById("tlmviewer-f0bd4bf7"), data);    
}, 0);
</script>



```python
surface = tlm.surfaces.Sphere(diameter=15, r=-18)

optics = nn.Sequential(
    tlm.Offset(
        tlm.Rotate(
            tlm.RaySource(material="SF10-nd"),
            [-20, 0]),
        y=10),
    tlm.Gap(10),
    
    tlm.KinematicSurface(nn.Sequential(
        
        tlm.CollisionSurface(s1),
        tlm.RefractiveBoundary("air", "clamp"),
        
    ), s1, scale=-1, anchors=("extent", "origin")),
    
    tlm.Gap(30),
    tlm.FocalPoint(),
)


tlm.show(optics, dim=2, sampling={"base": 10})
```


<div data-jp-suppress-context-menu id='tlmviewer-1bb1ac17' class='tlmviewer' style='width: 100%; aspect-ratio: 16 / 9;'></div><script type='module'>async function importtlm() {
    try {
        return await import("/tlmviewer.js");
    } catch (error) {
        console.log("error", error);
        return await import("/files/test_notebooks/tlmviewer.js");
    }
}

const module = await importtlm();
const tlmviewer = module.tlmviewer;

const data = '{"mode": "2D", "camera": "XY", "data": [{"type": "surfaces", "data": [{"matrix": [[-1.0, 0.0, 12.632503], [0.0, -1.0, 0.0], [0.0, 0.0, 1.0]], "samples": [[2.63250351, 7.50000143], [2.58157635, 7.43594599], [2.53108597, 7.37154436], [2.48103619, 7.30679989], [2.43142986, 7.24171686], [2.38226604, 7.17629385], [2.33355331, 7.11054182], [2.28528595, 7.04445457], [2.23747253, 6.97804165], [2.19011402, 6.91130447], [2.14321136, 6.84424591], [2.09676552, 6.7768693], [2.0507822, 6.70917702], [2.00526047, 6.64117336], [1.96020222, 6.57285786], [1.91561317, 6.50424194], [1.87149143, 6.43531799], [1.82784176, 6.36609793], [1.78466511, 6.29658127], [1.74196434, 6.22677183], [1.69973946, 6.15667343], [1.65799332, 6.08628845], [1.61672878, 6.01561975], [1.57594681, 5.94467211], [1.53565025, 5.87344742], [1.49583817, 5.80194759], [1.45651627, 5.73018074], [1.41768551, 5.65814686], [1.37934685, 5.58584976], [1.34150124, 5.51329279], [1.30415154, 5.44047976], [1.2672987, 5.36741352], [1.23094559, 5.2940979], [1.19509315, 5.22053576], [1.15974236, 5.14672852], [1.12489796, 5.07268715], [1.0905571, 4.9984045], [1.05672359, 4.92389202], [1.02340031, 4.84915066], [0.99058723, 4.77418375], [0.95828629, 4.69899464], [0.92649841, 4.62358713], [0.89522552, 4.54796457], [0.86446857, 4.47213078], [0.83423042, 4.3960886], [0.80451012, 4.31983948], [0.77531242, 4.24339247], [0.74663544, 4.16674709], [0.71848202, 4.08990908], [0.69085312, 4.01288033], [0.66375065, 3.93566513], [0.63717556, 3.85826683], [0.61112881, 3.78068924], [0.58561134, 3.70293546], [0.56062508, 3.62500978], [0.53617001, 3.54691529], [0.51224804, 3.46865344], [0.48886108, 3.3902328], [0.46600914, 3.31165457], [0.44369411, 3.23292208], [0.42191601, 3.15403962], [0.40067673, 3.0750103], [0.37997627, 2.99583769], [0.35981655, 2.91652608], [0.34019756, 2.83707881], [0.32112122, 2.75749683], [0.30258846, 2.67778945], [0.2845993, 2.59795737], [0.26715469, 2.51800442], [0.25025654, 2.43793464], [0.23390388, 2.35775137], [0.21809959, 2.27745843], [0.20284271, 2.19705963], [0.18813324, 2.11655855], [0.17397499, 2.03595924], [0.1603651, 1.95526218], [0.14730644, 1.87447715], [0.134799, 1.79360497], [0.1228447, 1.71264935], [0.11144066, 1.63161385], [0.10059071, 1.55050278], [0.09029388, 1.46931946], [0.08055115, 1.38806784], [0.0713625, 1.30675173], [0.06272888, 1.2253747], [0.05464935, 1.14393795], [0.04712582, 1.06245077], [0.04015923, 0.98091435], [0.03374672, 0.89933217], [0.02789307, 0.81770813], [0.02259445, 0.7360462], [0.01785469, 0.65434992], [0.01366997, 0.57262325], [0.0100441, 0.49086994], [0.00697517, 0.40909097], [0.0044651, 0.32729581], [0.00251102, 0.24548545], [0.0011158, 0.16366366], [0.00027847, 0.08183426], [0.0, -1.05e-06], [0.00027847, -0.08183426], [0.0011158, -0.16366366], [0.00251102, -0.24548545], [0.0044651, -0.32729581], [0.00697517, -0.40909097], [0.0100441, -0.49086994], [0.01366997, -0.57262325], [0.01785469, -0.65434992], [0.02259445, -0.7360462], [0.02789307, -0.81770813], [0.03374672, -0.89933217], [0.04015923, -0.98091435], [0.04712582, -1.06245077], [0.05464935, -1.14393795], [0.06272888, -1.2253747], [0.0713625, -1.30675173], [0.08055115, -1.38806784], [0.09029388, -1.46931946], [0.10059071, -1.55050278], [0.11144066, -1.63161385], [0.1228447, -1.71264935], [0.134799, -1.79360497], [0.14730644, -1.87447715], [0.1603651, -1.95526218], [0.17397499, -2.03595924], [0.18813324, -2.11655855], [0.20284271, -2.19705963], [0.21809959, -2.27745843], [0.23390388, -2.35775137], [0.25025654, -2.43793464], [0.26715469, -2.51800442], [0.2845993, -2.59795737], [0.30258846, -2.67778945], [0.32112122, -2.75749683], [0.34019756, -2.83707881], [0.35981655, -2.91652608], [0.37997627, -2.99583769], [0.40067673, -3.0750103], [0.42191601, -3.15403962], [0.44369411, -3.23292208], [0.46600914, -3.31165457], [0.48886108, -3.3902328], [0.51224804, -3.46865344], [0.53617001, -3.54691529], [0.56062508, -3.62500978], [0.58561134, -3.70293546], [0.61112881, -3.78068924], [0.63717556, -3.85826683], [0.66375065, -3.93566513], [0.69085312, -4.01288033], [0.71848202, -4.08990908], [0.74663544, -4.16674709], [0.77531242, -4.24339247], [0.80451012, -4.31983948], [0.83423042, -4.3960886], [0.86446857, -4.47213078], [0.89522552, -4.54796457], [0.92649841, -4.62358713], [0.95828629, -4.69899464], [0.99058723, -4.77418375], [1.02340031, -4.84915066], [1.05672359, -4.92389202], [1.0905571, -4.9984045], [1.12489796, -5.07268715], [1.15974236, -5.14672852], [1.19509315, -5.22053576], [1.23094559, -5.2940979], [1.2672987, -5.36741352], [1.30415154, -5.44047976], [1.34150124, -5.51329279], [1.37934685, -5.58584976], [1.41768551, -5.65814686], [1.45651627, -5.73018074], [1.49583817, -5.80194759], [1.53565025, -5.87344742], [1.57594681, -5.94467211], [1.61672878, -6.01561975], [1.65799332, -6.08628845], [1.69973946, -6.15667343], [1.74196434, -6.22677183], [1.78466511, -6.29658127], [1.82784176, -6.36609793], [1.87149143, -6.43531799], [1.91561317, -6.50424194], [1.96020222, -6.57285786], [2.00526047, -6.64117336], [2.0507822, -6.70917702], [2.09676552, -6.7768693], [2.14321136, -6.84424591], [2.19011402, -6.91130447], [2.23747253, -6.97804165], [2.28528595, -7.04445457], [2.33355331, -7.11054182], [2.38226604, -7.17629385], [2.43142986, -7.24171686], [2.48103619, -7.30679989], [2.53108597, -7.37154436], [2.58157635, -7.43594599], [2.63250351, -7.50000143]]}]}, {"type": "points", "data": [[42.632503, 0.0]], "color": "red"}, {"type": "rays", "points": [[0.0, 10.0, 11.03407135, 5.98392647]], "color": "#ffa724", "variables": {}, "domain": {}, "layers": [1]}, {"type": "rays", "points": [[11.03407135, 5.98392647, 27.07101489, -21.89231253]], "color": "#ffa724", "variables": {}, "domain": {}}, {"type": "points", "data": [[0.0, 0.0], [10.0, 0.0], [12.632503, 0.0], [42.632503, 0.0]], "layers": [4]}]}';

setTimeout(() => {
    tlmviewer.embed(document.getElementById("tlmviewer-1bb1ac17"), data);    
}, 0);
</script>



```python
surface = tlm.surfaces.Sphere(diameter=15, r=-18)

optics = nn.Sequential(
    tlm.Offset(
        tlm.Rotate(
            tlm.RaySource(material="SF10-nd"),
            [-20, 0]),
        y=10),
    tlm.Gap(10),

    #tlm.RefractiveSurface(s1, "air", -1, ("extent", "origin"), "drop"),
    tlm.ReflectiveSurface(s1, -1, ("extent", "origin")),
    
    tlm.Gap(30),
    tlm.FocalPoint(),
)


tlm.show(optics, dim=2, sampling={"base": 10})
```


<div data-jp-suppress-context-menu id='tlmviewer-f15dd5de' class='tlmviewer' style='width: 100%; aspect-ratio: 16 / 9;'></div><script type='module'>async function importtlm() {
    try {
        return await import("/tlmviewer.js");
    } catch (error) {
        console.log("error", error);
        return await import("/files/test_notebooks/tlmviewer.js");
    }
}

const module = await importtlm();
const tlmviewer = module.tlmviewer;

const data = '{"mode": "2D", "camera": "XY", "data": [{"type": "surfaces", "data": [{"matrix": [[-1.0, 0.0, 12.632503], [0.0, -1.0, 0.0], [0.0, 0.0, 1.0]], "samples": [[2.63250351, 7.50000143], [2.58157635, 7.43594599], [2.53108597, 7.37154436], [2.48103619, 7.30679989], [2.43142986, 7.24171686], [2.38226604, 7.17629385], [2.33355331, 7.11054182], [2.28528595, 7.04445457], [2.23747253, 6.97804165], [2.19011402, 6.91130447], [2.14321136, 6.84424591], [2.09676552, 6.7768693], [2.0507822, 6.70917702], [2.00526047, 6.64117336], [1.96020222, 6.57285786], [1.91561317, 6.50424194], [1.87149143, 6.43531799], [1.82784176, 6.36609793], [1.78466511, 6.29658127], [1.74196434, 6.22677183], [1.69973946, 6.15667343], [1.65799332, 6.08628845], [1.61672878, 6.01561975], [1.57594681, 5.94467211], [1.53565025, 5.87344742], [1.49583817, 5.80194759], [1.45651627, 5.73018074], [1.41768551, 5.65814686], [1.37934685, 5.58584976], [1.34150124, 5.51329279], [1.30415154, 5.44047976], [1.2672987, 5.36741352], [1.23094559, 5.2940979], [1.19509315, 5.22053576], [1.15974236, 5.14672852], [1.12489796, 5.07268715], [1.0905571, 4.9984045], [1.05672359, 4.92389202], [1.02340031, 4.84915066], [0.99058723, 4.77418375], [0.95828629, 4.69899464], [0.92649841, 4.62358713], [0.89522552, 4.54796457], [0.86446857, 4.47213078], [0.83423042, 4.3960886], [0.80451012, 4.31983948], [0.77531242, 4.24339247], [0.74663544, 4.16674709], [0.71848202, 4.08990908], [0.69085312, 4.01288033], [0.66375065, 3.93566513], [0.63717556, 3.85826683], [0.61112881, 3.78068924], [0.58561134, 3.70293546], [0.56062508, 3.62500978], [0.53617001, 3.54691529], [0.51224804, 3.46865344], [0.48886108, 3.3902328], [0.46600914, 3.31165457], [0.44369411, 3.23292208], [0.42191601, 3.15403962], [0.40067673, 3.0750103], [0.37997627, 2.99583769], [0.35981655, 2.91652608], [0.34019756, 2.83707881], [0.32112122, 2.75749683], [0.30258846, 2.67778945], [0.2845993, 2.59795737], [0.26715469, 2.51800442], [0.25025654, 2.43793464], [0.23390388, 2.35775137], [0.21809959, 2.27745843], [0.20284271, 2.19705963], [0.18813324, 2.11655855], [0.17397499, 2.03595924], [0.1603651, 1.95526218], [0.14730644, 1.87447715], [0.134799, 1.79360497], [0.1228447, 1.71264935], [0.11144066, 1.63161385], [0.10059071, 1.55050278], [0.09029388, 1.46931946], [0.08055115, 1.38806784], [0.0713625, 1.30675173], [0.06272888, 1.2253747], [0.05464935, 1.14393795], [0.04712582, 1.06245077], [0.04015923, 0.98091435], [0.03374672, 0.89933217], [0.02789307, 0.81770813], [0.02259445, 0.7360462], [0.01785469, 0.65434992], [0.01366997, 0.57262325], [0.0100441, 0.49086994], [0.00697517, 0.40909097], [0.0044651, 0.32729581], [0.00251102, 0.24548545], [0.0011158, 0.16366366], [0.00027847, 0.08183426], [0.0, -1.05e-06], [0.00027847, -0.08183426], [0.0011158, -0.16366366], [0.00251102, -0.24548545], [0.0044651, -0.32729581], [0.00697517, -0.40909097], [0.0100441, -0.49086994], [0.01366997, -0.57262325], [0.01785469, -0.65434992], [0.02259445, -0.7360462], [0.02789307, -0.81770813], [0.03374672, -0.89933217], [0.04015923, -0.98091435], [0.04712582, -1.06245077], [0.05464935, -1.14393795], [0.06272888, -1.2253747], [0.0713625, -1.30675173], [0.08055115, -1.38806784], [0.09029388, -1.46931946], [0.10059071, -1.55050278], [0.11144066, -1.63161385], [0.1228447, -1.71264935], [0.134799, -1.79360497], [0.14730644, -1.87447715], [0.1603651, -1.95526218], [0.17397499, -2.03595924], [0.18813324, -2.11655855], [0.20284271, -2.19705963], [0.21809959, -2.27745843], [0.23390388, -2.35775137], [0.25025654, -2.43793464], [0.26715469, -2.51800442], [0.2845993, -2.59795737], [0.30258846, -2.67778945], [0.32112122, -2.75749683], [0.34019756, -2.83707881], [0.35981655, -2.91652608], [0.37997627, -2.99583769], [0.40067673, -3.0750103], [0.42191601, -3.15403962], [0.44369411, -3.23292208], [0.46600914, -3.31165457], [0.48886108, -3.3902328], [0.51224804, -3.46865344], [0.53617001, -3.54691529], [0.56062508, -3.62500978], [0.58561134, -3.70293546], [0.61112881, -3.78068924], [0.63717556, -3.85826683], [0.66375065, -3.93566513], [0.69085312, -4.01288033], [0.71848202, -4.08990908], [0.74663544, -4.16674709], [0.77531242, -4.24339247], [0.80451012, -4.31983948], [0.83423042, -4.3960886], [0.86446857, -4.47213078], [0.89522552, -4.54796457], [0.92649841, -4.62358713], [0.95828629, -4.69899464], [0.99058723, -4.77418375], [1.02340031, -4.84915066], [1.05672359, -4.92389202], [1.0905571, -4.9984045], [1.12489796, -5.07268715], [1.15974236, -5.14672852], [1.19509315, -5.22053576], [1.23094559, -5.2940979], [1.2672987, -5.36741352], [1.30415154, -5.44047976], [1.34150124, -5.51329279], [1.37934685, -5.58584976], [1.41768551, -5.65814686], [1.45651627, -5.73018074], [1.49583817, -5.80194759], [1.53565025, -5.87344742], [1.57594681, -5.94467211], [1.61672878, -6.01561975], [1.65799332, -6.08628845], [1.69973946, -6.15667343], [1.74196434, -6.22677183], [1.78466511, -6.29658127], [1.82784176, -6.36609793], [1.87149143, -6.43531799], [1.91561317, -6.50424194], [1.96020222, -6.57285786], [2.00526047, -6.64117336], [2.0507822, -6.70917702], [2.09676552, -6.7768693], [2.14321136, -6.84424591], [2.19011402, -6.91130447], [2.23747253, -6.97804165], [2.28528595, -7.04445457], [2.33355331, -7.11054182], [2.38226604, -7.17629385], [2.43142986, -7.24171686], [2.48103619, -7.30679989], [2.53108597, -7.37154436], [2.58157635, -7.43594599], [2.63250351, -7.50000143]]}]}, {"type": "points", "data": [[42.632503, 0.0]], "color": "red"}, {"type": "rays", "points": [[0.0, 10.0, 11.03407135, 5.98392647]], "color": "#ffa724", "variables": {}, "domain": {}, "layers": [1]}, {"type": "rays", "points": [[11.03407135, 5.98392647, 5.35163829, -25.67011298]], "color": "#ffa724", "variables": {}, "domain": {}}, {"type": "points", "data": [[0.0, 0.0], [10.0, 0.0], [12.632503, 0.0], [42.632503, 0.0]], "layers": [4]}]}';

setTimeout(() => {
    tlmviewer.embed(document.getElementById("tlmviewer-f15dd5de"), data);    
}, 0);
</script>



```python
surface = tlm.surfaces.Sphere(diameter=15, r=-18)

optics = nn.Sequential(
    tlm.Offset(
        tlm.Rotate(
            tlm.RaySource(material="SF10-nd"),
            [-20, 0]),
        y=10),
    tlm.Gap(10),

    tlm.Offset(
        tlm.ReflectiveSurface(s1, -1, ("extent", "origin")),
        y=10),
    
    tlm.Gap(30),
    tlm.FocalPoint(),
)

print(optics)

tlm.show(optics, dim=2, sampling={"base": 10})
```

    Sequential(
      (0): Offset(
        (element): Rotate(
          (element): RaySource()
        )
      )
      (1): Gap()
      (2): Offset(
        (element): ReflectiveSurface(
          (element): Sequential(
            (0): CollisionSurface()
            (1): ReflectiveBoundary()
          )
        )
      )
      (3): Gap()
      (4): FocalPoint()
    )



<div data-jp-suppress-context-menu id='tlmviewer-a09feeb0' class='tlmviewer' style='width: 100%; aspect-ratio: 16 / 9;'></div><script type='module'>async function importtlm() {
    try {
        return await import("/tlmviewer.js");
    } catch (error) {
        console.log("error", error);
        return await import("/files/test_notebooks/tlmviewer.js");
    }
}

const module = await importtlm();
const tlmviewer = module.tlmviewer;

const data = '{"mode": "2D", "camera": "XY", "data": [{"type": "surfaces", "data": [{"matrix": [[-1.0, 0.0, 12.632503], [0.0, -1.0, 10.0], [0.0, 0.0, 1.0]], "samples": [[2.63250351, 7.50000143], [2.58157635, 7.43594599], [2.53108597, 7.37154436], [2.48103619, 7.30679989], [2.43142986, 7.24171686], [2.38226604, 7.17629385], [2.33355331, 7.11054182], [2.28528595, 7.04445457], [2.23747253, 6.97804165], [2.19011402, 6.91130447], [2.14321136, 6.84424591], [2.09676552, 6.7768693], [2.0507822, 6.70917702], [2.00526047, 6.64117336], [1.96020222, 6.57285786], [1.91561317, 6.50424194], [1.87149143, 6.43531799], [1.82784176, 6.36609793], [1.78466511, 6.29658127], [1.74196434, 6.22677183], [1.69973946, 6.15667343], [1.65799332, 6.08628845], [1.61672878, 6.01561975], [1.57594681, 5.94467211], [1.53565025, 5.87344742], [1.49583817, 5.80194759], [1.45651627, 5.73018074], [1.41768551, 5.65814686], [1.37934685, 5.58584976], [1.34150124, 5.51329279], [1.30415154, 5.44047976], [1.2672987, 5.36741352], [1.23094559, 5.2940979], [1.19509315, 5.22053576], [1.15974236, 5.14672852], [1.12489796, 5.07268715], [1.0905571, 4.9984045], [1.05672359, 4.92389202], [1.02340031, 4.84915066], [0.99058723, 4.77418375], [0.95828629, 4.69899464], [0.92649841, 4.62358713], [0.89522552, 4.54796457], [0.86446857, 4.47213078], [0.83423042, 4.3960886], [0.80451012, 4.31983948], [0.77531242, 4.24339247], [0.74663544, 4.16674709], [0.71848202, 4.08990908], [0.69085312, 4.01288033], [0.66375065, 3.93566513], [0.63717556, 3.85826683], [0.61112881, 3.78068924], [0.58561134, 3.70293546], [0.56062508, 3.62500978], [0.53617001, 3.54691529], [0.51224804, 3.46865344], [0.48886108, 3.3902328], [0.46600914, 3.31165457], [0.44369411, 3.23292208], [0.42191601, 3.15403962], [0.40067673, 3.0750103], [0.37997627, 2.99583769], [0.35981655, 2.91652608], [0.34019756, 2.83707881], [0.32112122, 2.75749683], [0.30258846, 2.67778945], [0.2845993, 2.59795737], [0.26715469, 2.51800442], [0.25025654, 2.43793464], [0.23390388, 2.35775137], [0.21809959, 2.27745843], [0.20284271, 2.19705963], [0.18813324, 2.11655855], [0.17397499, 2.03595924], [0.1603651, 1.95526218], [0.14730644, 1.87447715], [0.134799, 1.79360497], [0.1228447, 1.71264935], [0.11144066, 1.63161385], [0.10059071, 1.55050278], [0.09029388, 1.46931946], [0.08055115, 1.38806784], [0.0713625, 1.30675173], [0.06272888, 1.2253747], [0.05464935, 1.14393795], [0.04712582, 1.06245077], [0.04015923, 0.98091435], [0.03374672, 0.89933217], [0.02789307, 0.81770813], [0.02259445, 0.7360462], [0.01785469, 0.65434992], [0.01366997, 0.57262325], [0.0100441, 0.49086994], [0.00697517, 0.40909097], [0.0044651, 0.32729581], [0.00251102, 0.24548545], [0.0011158, 0.16366366], [0.00027847, 0.08183426], [0.0, -1.05e-06], [0.00027847, -0.08183426], [0.0011158, -0.16366366], [0.00251102, -0.24548545], [0.0044651, -0.32729581], [0.00697517, -0.40909097], [0.0100441, -0.49086994], [0.01366997, -0.57262325], [0.01785469, -0.65434992], [0.02259445, -0.7360462], [0.02789307, -0.81770813], [0.03374672, -0.89933217], [0.04015923, -0.98091435], [0.04712582, -1.06245077], [0.05464935, -1.14393795], [0.06272888, -1.2253747], [0.0713625, -1.30675173], [0.08055115, -1.38806784], [0.09029388, -1.46931946], [0.10059071, -1.55050278], [0.11144066, -1.63161385], [0.1228447, -1.71264935], [0.134799, -1.79360497], [0.14730644, -1.87447715], [0.1603651, -1.95526218], [0.17397499, -2.03595924], [0.18813324, -2.11655855], [0.20284271, -2.19705963], [0.21809959, -2.27745843], [0.23390388, -2.35775137], [0.25025654, -2.43793464], [0.26715469, -2.51800442], [0.2845993, -2.59795737], [0.30258846, -2.67778945], [0.32112122, -2.75749683], [0.34019756, -2.83707881], [0.35981655, -2.91652608], [0.37997627, -2.99583769], [0.40067673, -3.0750103], [0.42191601, -3.15403962], [0.44369411, -3.23292208], [0.46600914, -3.31165457], [0.48886108, -3.3902328], [0.51224804, -3.46865344], [0.53617001, -3.54691529], [0.56062508, -3.62500978], [0.58561134, -3.70293546], [0.61112881, -3.78068924], [0.63717556, -3.85826683], [0.66375065, -3.93566513], [0.69085312, -4.01288033], [0.71848202, -4.08990908], [0.74663544, -4.16674709], [0.77531242, -4.24339247], [0.80451012, -4.31983948], [0.83423042, -4.3960886], [0.86446857, -4.47213078], [0.89522552, -4.54796457], [0.92649841, -4.62358713], [0.95828629, -4.69899464], [0.99058723, -4.77418375], [1.02340031, -4.84915066], [1.05672359, -4.92389202], [1.0905571, -4.9984045], [1.12489796, -5.07268715], [1.15974236, -5.14672852], [1.19509315, -5.22053576], [1.23094559, -5.2940979], [1.2672987, -5.36741352], [1.30415154, -5.44047976], [1.34150124, -5.51329279], [1.37934685, -5.58584976], [1.41768551, -5.65814686], [1.45651627, -5.73018074], [1.49583817, -5.80194759], [1.53565025, -5.87344742], [1.57594681, -5.94467211], [1.61672878, -6.01561975], [1.65799332, -6.08628845], [1.69973946, -6.15667343], [1.74196434, -6.22677183], [1.78466511, -6.29658127], [1.82784176, -6.36609793], [1.87149143, -6.43531799], [1.91561317, -6.50424194], [1.96020222, -6.57285786], [2.00526047, -6.64117336], [2.0507822, -6.70917702], [2.09676552, -6.7768693], [2.14321136, -6.84424591], [2.19011402, -6.91130447], [2.23747253, -6.97804165], [2.28528595, -7.04445457], [2.33355331, -7.11054182], [2.38226604, -7.17629385], [2.43142986, -7.24171686], [2.48103619, -7.30679989], [2.53108597, -7.37154436], [2.58157635, -7.43594599], [2.63250351, -7.50000143]]}]}, {"type": "points", "data": [[40.0, 0.0]], "color": "red"}, {"type": "rays", "points": [[0.0, 10.0, 11.83299318, 5.6931427]], "color": "#ffa724", "variables": {}, "domain": {}, "layers": [1]}, {"type": "rays", "points": [[11.83299318, 5.6931427, -14.79871882, 16.48870026]], "color": "#ffa724", "variables": {}, "domain": {}}, {"type": "points", "data": [[0.0, 0.0], [10.0, 0.0], [40.0, 0.0]], "layers": [4]}]}';

setTimeout(() => {
    tlmviewer.embed(document.getElementById("tlmviewer-a09feeb0"), data);    
}, 0);
</script>

